# CDN 内容分发网络 
(Content Delivery Network)

CDN是构建在现有网络基础之上的智能虚拟网络，依靠部署在各地的边缘服务器，通过中心平台的负载均衡、内容分发、调度等功能模块，使用户就近获取所需内容，降低网络拥塞，提高用户访问响应速度和命中率。

# 传统网站的请求响应过程
1. 输入网站域名
2. 浏览器向本地DNS服务器请求对该域名的解析
3. 本地DNS服务器中如果缓存有这个域名的解析结果，则直接响应用户的解析请求。
4. 本地DNS服务器中如果没有关于这个域名的解析结果的缓存，则以迭代方式向整个DNS系统（相应的DNS服务器）请求解析，获得应答后将结果反馈给浏览器
5. 浏览器得到域名解析结果，就是该域名相应的服务设备的IP地址
6. 浏览器获取IP地址之后，经过标准的TCP握手流程，建立TCP连接。
7. 浏览器向服务器发起HTTP请求。
8. 服务器将用户请求内容传送给浏览器。
9. 经过标准的TCP挥手流程，断开TCP连接。

# 引入CDN之后 用户访问经历

1. 当用户点击网站页面上的内容URL，先经过本地DNS系统解析，如果本地DNS服务器没有相应域名的缓存，则本地DNS系统会将域名的解析权交给CNAME指向的CDN专用DNS服务器。
2. CDN的DNS服务器将CDN的全局负载均衡设备IP地址返回给用户。
用户向CDN的全局负载均衡设备发起URL访问请求。
3. CDN全局负载均衡设备根据用户IP地址，以及用户请求的URL，选择一台用户所属区域的区域负载均衡设备，并将请求转发到此设备上。

（CDN全局负载均衡设备会选择一个相对于用户较近的 访问快的服务器 让用户访问）

4. 基于以下这些条件的综合分析之后，区域负载均衡设备会选择一个最优的缓存服务器节点，并从缓存服务器节点处得到缓存服务器的IP地址，最终将得到的IP地址返回给全局负载均衡设备：

> 1. 根据用户IP地址，判断哪一个边缘节点距用户最近；
> 2. 根据用户所请求的URL中携带的内容名称，判断哪一个边缘节点上有用户 所需内容；
> 3. 查询各个边缘节点当前的负载情况，判断哪一个边缘节点尚有服务能力。


全局负载均衡设备把服务器的IP地址返回给用户。
用户向缓存服务器发起请求，缓存服务器响应用户请求，将用户所需内容传送到用户终端。如果这台缓存服务器上并没有用户想要的内容，而区域均衡设备依然将它分配给了用户，那么这台服务器就要向它的上一级缓存服务器请求内容，直至追溯到网站的源服务器将内容拉到本地。

>作者：小嘟
链接：https://juejin.cn/post/7008708776119894029
来源：稀土掘金
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。

